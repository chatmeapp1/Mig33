
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String        @id @default(uuid())
  username          String        @unique
  email             String        @unique
  password          String
  name              String?
  avatar            String?
  status            String        @default("online")
  role              String        @default("user")
  credits           Int           @default(0)
  friends           String[]
  friendRequests    String[]
  blockedUsers      String[]
  isActive          Boolean       @default(true)
  lastSeen          DateTime      @default(now())
  createdAt         DateTime      @default(now())
  
  sentMessages      Message[]     @relation("SentMessages")
  receivedMessages  Message[]     @relation("ReceivedMessages")
  ownedChatrooms    Chatroom[]    @relation("OwnedChatrooms")
  chatroomMembers   Chatroom[]    @relation("ChatroomMembers")
  moderatedRooms    Chatroom[]    @relation("ModeratedRooms")
  bannedFromRooms   Chatroom[]    @relation("BannedUsers")
  transactions      Transaction[] @relation("UserTransactions")
  receivedTrans     Transaction[] @relation("ReceivedTransactions")
}

model Message {
  id         String    @id @default(uuid())
  senderId   String
  receiverId String?
  chatroomId String?
  content    String
  type       String    @default("text")
  giftId     String?
  isPrivate  Boolean   @default(false)
  read       Boolean   @default(false)
  createdAt  DateTime  @default(now())
  
  sender     User      @relation("SentMessages", fields: [senderId], references: [id])
  receiver   User?     @relation("ReceivedMessages", fields: [receiverId], references: [id])
  chatroom   Chatroom? @relation(fields: [chatroomId], references: [id])
  gift       Gift?     @relation(fields: [giftId], references: [id])
}

model Chatroom {
  id          String    @id @default(uuid())
  name        String
  description String    @default("")
  type        String    @default("public")
  ownerId     String
  memberIds   String[]
  moderatorIds String[]
  bannedUserIds String[]
  maxMembers  Int       @default(100)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  
  owner       User      @relation("OwnedChatrooms", fields: [ownerId], references: [id])
  members     User[]    @relation("ChatroomMembers")
  moderators  User[]    @relation("ModeratedRooms")
  bannedUsers User[]    @relation("BannedUsers")
  messages    Message[]
}

model Gift {
  id          String    @id @default(uuid())
  name        String
  description String?
  image       String
  price       Int
  category    String    @default("general")
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  
  messages    Message[]
}

model Transaction {
  id          String   @id @default(uuid())
  userId      String
  type        String
  amount      Int
  receiverId  String?
  description String?
  status      String   @default("completed")
  createdAt   DateTime @default(now())
  
  user        User     @relation("UserTransactions", fields: [userId], references: [id])
  receiver    User?    @relation("ReceivedTransactions", fields: [receiverId], references: [id])
}
